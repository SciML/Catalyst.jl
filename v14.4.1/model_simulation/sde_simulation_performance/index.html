<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Advice for performant SDE simulations · Catalyst.jl</title><meta name="title" content="Advice for performant SDE simulations · Catalyst.jl"/><meta property="og:title" content="Advice for performant SDE simulations · Catalyst.jl"/><meta property="twitter:title" content="Advice for performant SDE simulations · Catalyst.jl"/><meta name="description" content="Documentation for Catalyst.jl."/><meta property="og:description" content="Documentation for Catalyst.jl."/><meta property="twitter:description" content="Documentation for Catalyst.jl."/><meta property="og:url" content="https://docs.sciml.ai/Catalyst/stable/model_simulation/sde_simulation_performance/"/><meta property="twitter:url" content="https://docs.sciml.ai/Catalyst/stable/model_simulation/sde_simulation_performance/"/><link rel="canonical" href="https://docs.sciml.ai/Catalyst/stable/model_simulation/sde_simulation_performance/"/><script async src="https://www.googletagmanager.com/gtag/js?id=UA-90474609-3"></script><script>  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'UA-90474609-3', {'page_path': location.pathname + location.search + location.hash});
</script><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../search_index.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script><link href="../../assets/favicon.ico" rel="icon" type="image/x-icon"/></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../"><img src="../../assets/logo.png" alt="Catalyst.jl logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../../">Catalyst.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><span class="tocitem">Introduction to Catalyst</span><ul><li><a class="tocitem" href="../../introduction_to_catalyst/catalyst_for_new_julia_users/">Introduction to Catalyst and Julia for New Julia users</a></li><li><a class="tocitem" href="../../introduction_to_catalyst/introduction_to_catalyst/">Introduction to Catalyst</a></li><li><a class="tocitem" href="../../introduction_to_catalyst/math_models_intro/">Mathematical Models Catalyst can Generate</a></li></ul></li><li><span class="tocitem">Model Creation and Properties</span><ul><li><a class="tocitem" href="../../model_creation/dsl_basics/">The Catalyst DSL - Introduction</a></li><li><a class="tocitem" href="../../model_creation/dsl_advanced/">The Catalyst DSL - Advanced Features and Options</a></li><li><a class="tocitem" href="../../model_creation/programmatic_CRN_construction/">Programmatic Construction of Symbolic Reaction Systems</a></li><li><a class="tocitem" href="../../model_creation/compositional_modeling/">Compositional Modeling of Reaction Systems</a></li><li><a class="tocitem" href="../../model_creation/constraint_equations/">Constraint Equations and Events</a></li><li><a class="tocitem" href="../../model_creation/conservation_laws/">Working with conservation laws</a></li><li><a class="tocitem" href="../../model_creation/parametric_stoichiometry/">Symbolic Stochiometries</a></li><li><a class="tocitem" href="../../model_creation/model_file_loading_and_export/">Loading Chemical Reaction Network Models from Files</a></li><li><a class="tocitem" href="../../model_creation/model_visualisation/">Model Visualisation</a></li><li><a class="tocitem" href="../../model_creation/reactionsystem_content_accessing/">Accessing model properties</a></li><li><a class="tocitem" href="../../model_creation/network_analysis/">Network Analysis in Catalyst</a></li><li><a class="tocitem" href="../../model_creation/chemistry_related_functionality/">Chemistry-related functionality</a></li><li><input class="collapse-toggle" id="menuitem-3-13" type="checkbox"/><label class="tocitem" for="menuitem-3-13"><span class="docs-label">Model creation examples</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../model_creation/examples/basic_CRN_library/">Library of Basic Chemical Reaction Network Models</a></li><li><a class="tocitem" href="../../model_creation/examples/programmatic_generative_linear_pathway/">Programmatic, generative, modelling of a linear pathway</a></li><li><a class="tocitem" href="../../model_creation/examples/hodgkin_huxley_equation/">Hodgkin-Huxley Equation</a></li><li><a class="tocitem" href="../../model_creation/examples/smoluchowski_coagulation_equation/">Smoluchowski Coagulation Equation</a></li></ul></li></ul></li><li><span class="tocitem">Model simulation</span><ul><li><a class="tocitem" href="../simulation_introduction/">Model Simulation Introduction</a></li><li><a class="tocitem" href="../simulation_plotting/">Simulation plotting</a></li><li><a class="tocitem" href="../simulation_structure_interfacing/">Interfacing problems, integrators, and solutions</a></li><li><a class="tocitem" href="../ensemble_simulations/">Ensemble/Monte Carlo Simulations</a></li><li><a class="tocitem" href="../ode_simulation_performance/">Advice for performant ODE simulations</a></li><li class="is-active"><a class="tocitem" href>Advice for performant SDE simulations</a><ul class="internal"><li><a class="tocitem" href="#sde_simulation_performance_solvers"><span>SDE solver selection</span></a></li><li><a class="tocitem" href="#sde_simulation_performance_jacobian"><span>Options for Jacobian computation</span></a></li><li><a class="tocitem" href="#sde_simulation_performance_parallelisation"><span>Parallelisation on CPUs and GPUs</span></a></li></ul></li><li><input class="collapse-toggle" id="menuitem-4-7" type="checkbox"/><label class="tocitem" for="menuitem-4-7"><span class="docs-label">Model simulation examples</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../examples/periodic_events_simulation/">Modelling a periodic event during ODE and jump simulations</a></li></ul></li></ul></li><li><span class="tocitem">Steady state analysis</span><ul><li><a class="tocitem" href="../../steady_state_functionality/homotopy_continuation/">Finding Steady States through Homotopy Continuation</a></li><li><a class="tocitem" href="../../steady_state_functionality/nonlinear_solve/">Finding Steady States using NonlinearSolve.jl and SteadyStateDiffEq.jl</a></li><li><a class="tocitem" href="../../steady_state_functionality/steady_state_stability_computation/">Steady state stability computation</a></li><li><a class="tocitem" href="../../steady_state_functionality/bifurcation_diagrams/">Bifurcation Diagrams</a></li><li><a class="tocitem" href="../../steady_state_functionality/dynamical_systems/">Analysing model steady state properties with DynamicalSystems.jl</a></li></ul></li><li><span class="tocitem">Inverse Problems</span><ul><li><a class="tocitem" href="../../inverse_problems/optimization_ode_param_fitting/">Parameter Fitting for ODEs using Optimization.jl and DiffEqParamEstim.jl</a></li><li><a class="tocitem" href="../../inverse_problems/behaviour_optimisation/">Optimization for non-data fitting purposes</a></li><li><a class="tocitem" href="../../inverse_problems/structural_identifiability/">Structural Identifiability Analysis</a></li><li><a class="tocitem" href="../../inverse_problems/global_sensitivity_analysis/">Global Sensitivity Analysis</a></li><li><input class="collapse-toggle" id="menuitem-6-5" type="checkbox"/><label class="tocitem" for="menuitem-6-5"><span class="docs-label">Inverse problem examples</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../inverse_problems/examples/ode_fitting_oscillation/">Fitting Parameters for an Oscillatory System</a></li></ul></li></ul></li><li><span class="tocitem">Spatial Modelling</span><ul><li><a class="tocitem" href="../../spatial_modelling/lattice_reaction_systems/">Introduction to Spatial Modelling with Catalyst</a></li><li><a class="tocitem" href="../../spatial_modelling/lattice_simulation_structure_ interaction/">Interfacing with Lattice Problems, Integrators, and Solutions</a></li><li><a class="tocitem" href="../../spatial_modelling/lattice_simulation_plotting/">Plotting Spatial Simulations</a></li><li><a class="tocitem" href="../../spatial_modelling/spatial_ode_simulations/">Spatial ODE simulations</a></li><li><a class="tocitem" href="../../spatial_modelling/spatial_jump_simulations/">Spatial jump simulations</a></li></ul></li><li><a class="tocitem" href="../../faqs/">FAQs</a></li><li><a class="tocitem" href="../../api/">API</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Model simulation</a></li><li class="is-active"><a href>Advice for performant SDE simulations</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Advice for performant SDE simulations</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/SciML/Catalyst.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/SciML/Catalyst.jl/blob/master/docs/src/model_simulation/sde_simulation_performance.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="sde_simulation_performance"><a class="docs-heading-anchor" href="#sde_simulation_performance">Advice for performant SDE simulations</a><a id="sde_simulation_performance-1"></a><a class="docs-heading-anchor-permalink" href="#sde_simulation_performance" title="Permalink"></a></h1><p>While there exist relatively straightforward approaches to manage performance for <a href="../ode_simulation_performance/#ode_simulation_performance">ODE</a> and jump simulations, this is generally not the case for SDE simulations. Below, we briefly describe some options. However, as one starts to investigate these, one quickly reaches what is (or could be) active areas of research.</p><h2 id="sde_simulation_performance_solvers"><a class="docs-heading-anchor" href="#sde_simulation_performance_solvers">SDE solver selection</a><a id="sde_simulation_performance_solvers-1"></a><a class="docs-heading-anchor-permalink" href="#sde_simulation_performance_solvers" title="Permalink"></a></h2><p>We have previously described how <a href="../ode_simulation_performance/#ode_simulation_performance_solvers">ODE solver selection</a> can impact simulation performance. Again, it can be worthwhile to investigate solver selection&#39;s impact on performance for SDE simulations. Throughout this documentation, we generally use the <code>STrapezoid</code> solver as the default choice. However, if the <code>DifferentialEquations</code> package is loaded</p><pre><code class="language-julia hljs">using DifferentialEquations</code></pre><p>automatic SDE solver selection enabled (just like is the case for ODEs by default). Generally, the automatic SDE solver choice enabled by <code>DifferentialEquations</code> is better than just using <code>STrapezoid</code>. Next, if performance is critical, it can be worthwhile to check the <a href="https://docs.sciml.ai/DiffEqDocs/stable/solvers/sde_solve/">list of available SDE solvers</a> to find one with advantageous performance for a given problem. When doing so, it is important to pick a solver compatible with <em>non-diagonal noise</em> and with <a href="https://en.wikipedia.org/wiki/It%C3%B4_calculus"><em>Ito problems</em></a>. </p><h2 id="sde_simulation_performance_jacobian"><a class="docs-heading-anchor" href="#sde_simulation_performance_jacobian">Options for Jacobian computation</a><a id="sde_simulation_performance_jacobian-1"></a><a class="docs-heading-anchor-permalink" href="#sde_simulation_performance_jacobian" title="Permalink"></a></h2><p>In the section on ODE simulation performance, we describe various <a href="../ode_simulation_performance/#ode_simulation_performance_jacobian">options for computing the system Jacobian</a>, and how these could be used to improve performance for <a href="../ode_simulation_performance/#ode_simulation_performance_stiffness">implicit solvers</a>. These can be used in tandem with implicit SDE solvers (such as <code>STrapezoid</code>). However, due to additional considerations during SDE simulations, it is much less certain whether these will actually have any impact on performance. So while these options might be worth reading about and trialling, there is no guarantee that they will be beneficial.</p><h2 id="sde_simulation_performance_parallelisation"><a class="docs-heading-anchor" href="#sde_simulation_performance_parallelisation">Parallelisation on CPUs and GPUs</a><a id="sde_simulation_performance_parallelisation-1"></a><a class="docs-heading-anchor-permalink" href="#sde_simulation_performance_parallelisation" title="Permalink"></a></h2><p>We have previously described how simulation parallelisation can be used to <a href="../ode_simulation_performance/#ode_simulation_performance_parallelisation">improve performance when multiple ODE simulations are carried out</a>. The same approaches can be used for SDE simulations. Indeed, it is often more relevant for SDEs, as these are often re-simulated using identical simulation conditions (to investigate their typical behaviour across many samples). CPU parallelisation of SDE simulations uses the <a href="../ode_simulation_performance/#ode_simulation_performance_parallelisation_CPU">same approach as ODEs</a>. GPU parallelisation requires some additional considerations, which are described below.</p><h3 id="sde_simulation_performance_parallelisation_GPU"><a class="docs-heading-anchor" href="#sde_simulation_performance_parallelisation_GPU">GPU parallelisation of SDE simulations</a><a id="sde_simulation_performance_parallelisation_GPU-1"></a><a class="docs-heading-anchor-permalink" href="#sde_simulation_performance_parallelisation_GPU" title="Permalink"></a></h3><p>GPU parallelisation of SDE simulations uses a similar approach as that for <a href="../ode_simulation_performance/#ode_simulation_performance_parallelisation_GPU">ODE simulations</a>. The main differences are that SDE parallelisation requires a GPU SDE solver (like <code>GPUEM</code>) and fixed time stepping.</p><p>We will assume that we are using the CUDA GPU hardware, so we will first load the <a href="https://github.com/JuliaGPU/CUDA.jl">CUDA.jl</a> backend package, as well as DiffEqGPU:</p><pre><code class="language-julia hljs">using CUDA, DiffEqGPU</code></pre><p>Which backend package you should use depends on your available hardware, with the alternatives being listed <a href="https://docs.sciml.ai/DiffEqGPU/stable/manual/backends/">here</a>.</p><p>Next, we create the <code>SDEProblem</code> which we wish to simulate. Like for ODEs, we ensure that all vectors are <a href="https://github.com/JuliaArrays/StaticArrays.jl">static vectors</a> and that all values are <code>Float32</code>s. Here we prepare the parallel simulations of a simple <a href="../../model_creation/examples/basic_CRN_library/#basic_CRN_library_bd">birth-death process</a>.</p><pre><code class="language-julia hljs">using Catalyst, StochasticDiffEq, StaticArrays
bd_model = @reaction_network begin
    (p,d), 0 &lt;--&gt; X
end
@unpack X, p, d = bd_model

u0 = @SVector [X =&gt; 20.0f0]
tspan = (0.0f0, 10.0f0)
ps = @SVector [p =&gt; 10.0f0, d =&gt; 1.0f0]
sprob = SDEProblem(bd_model, u0, tspan, ps)</code></pre><p>The <code>SDEProblem</code> is then used to <a href="../ensemble_simulations/#ensemble_simulations_monte_carlo">create an <code>EnsembleProblem</code></a>.</p><pre><code class="language-julia hljs">eprob = EnsembleProblem(sprob)</code></pre><p>Finally, we can solve our <code>EnsembleProblem</code> while:</p><ul><li>Using a valid GPU SDE solver (either <a href="https://docs.sciml.ai/DiffEqGPU/stable/manual/ensemblegpukernel/#DiffEqGPU.GPUEM"><code>GPUEM</code></a> or <a href="https://docs.sciml.ai/DiffEqGPU/stable/manual/ensemblegpukernel/#DiffEqGPU.GPUSIEA"><code>GPUSIEA</code></a>).</li><li>Designating the GPU ensemble method, <code>EnsembleGPUKernel</code> (with the correct GPU backend as input).</li><li>Designating the number of trajectories we wish to simulate.</li><li>Designating a fixed time step size.</li></ul><pre><code class="language-julia hljs">esol = solve(eprob, GPUEM(), EnsembleGPUKernel(CUDA.CUDABackend()); trajectories = 10000, dt = 0.01)</code></pre><p>Above we parallelise GPU simulations with identical initial conditions and parameter values. However, <a href="../ensemble_simulations/#ensemble_simulations_varying_conditions">varying these</a> is also possible.</p><h3 id="sde_simulation_performance_parallelisation_mlmc"><a class="docs-heading-anchor" href="#sde_simulation_performance_parallelisation_mlmc">Multilevel Monte Carlo</a><a id="sde_simulation_performance_parallelisation_mlmc-1"></a><a class="docs-heading-anchor-permalink" href="#sde_simulation_performance_parallelisation_mlmc" title="Permalink"></a></h3><p>An approach for speeding up parallel stochastic simulations is so-called <a href="https://en.wikipedia.org/wiki/Multilevel_Monte_Carlo_method"><em>multilevel Monte Carlo approaches</em></a> (MLMC). These are used when a stochastic process is simulated repeatedly using identical simulation conditions. Here, instead of performing all simulations using identical <a href="../ode_simulation_performance/#ode_simulation_performance_error">tolerance</a>, the ensemble is simulated using a range of tolerances (primarily lower ones, which yields faster simulations). Currently, <a href="https://github.com/SciML/StochasticDiffEq.jl">StochasticDiffEq.jl</a> do not have a native implementation for performing MLMC simulations (this will hopefully be added in the future). However, if high performance of parallel SDE simulations is required, these approaches may be worth investigating.</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../ode_simulation_performance/">« Advice for performant ODE simulations</a><a class="docs-footer-nextpage" href="../examples/periodic_events_simulation/">Modelling a periodic event during ODE and jump simulations »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.7.0 on <span class="colophon-date" title="Monday 9 September 2024 19:50">Monday 9 September 2024</span>. Using Julia version 1.10.5.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
