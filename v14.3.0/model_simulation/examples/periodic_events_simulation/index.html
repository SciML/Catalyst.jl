<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Modelling a periodic event during ODE and jump simulations · Catalyst.jl</title><meta name="title" content="Modelling a periodic event during ODE and jump simulations · Catalyst.jl"/><meta property="og:title" content="Modelling a periodic event during ODE and jump simulations · Catalyst.jl"/><meta property="twitter:title" content="Modelling a periodic event during ODE and jump simulations · Catalyst.jl"/><meta name="description" content="Documentation for Catalyst.jl."/><meta property="og:description" content="Documentation for Catalyst.jl."/><meta property="twitter:description" content="Documentation for Catalyst.jl."/><meta property="og:url" content="https://docs.sciml.ai/Catalyst/stable/model_simulation/examples/periodic_events_simulation/"/><meta property="twitter:url" content="https://docs.sciml.ai/Catalyst/stable/model_simulation/examples/periodic_events_simulation/"/><link rel="canonical" href="https://docs.sciml.ai/Catalyst/stable/model_simulation/examples/periodic_events_simulation/"/><script async src="https://www.googletagmanager.com/gtag/js?id=UA-90474609-3"></script><script>  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'UA-90474609-3', {'page_path': location.pathname + location.search + location.hash});
</script><script data-outdated-warner src="../../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../../assets/documenter.js"></script><script src="../../../search_index.js"></script><script src="../../../siteinfo.js"></script><script src="../../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../../assets/themeswap.js"></script><link href="../../../assets/favicon.ico" rel="icon" type="image/x-icon"/></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../../"><img src="../../../assets/logo.png" alt="Catalyst.jl logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../../../">Catalyst.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../../">Home</a></li><li><span class="tocitem">Introduction to Catalyst</span><ul><li><a class="tocitem" href="../../../introduction_to_catalyst/catalyst_for_new_julia_users/">Introduction to Catalyst and Julia for New Julia users</a></li><li><a class="tocitem" href="../../../introduction_to_catalyst/introduction_to_catalyst/">Introduction to Catalyst</a></li><li><a class="tocitem" href="../../../introduction_to_catalyst/math_models_intro/">Mathematical Models Catalyst can Generate</a></li></ul></li><li><span class="tocitem">Model Creation and Properties</span><ul><li><a class="tocitem" href="../../../model_creation/dsl_basics/">The Catalyst DSL - Introduction</a></li><li><a class="tocitem" href="../../../model_creation/dsl_advanced/">The Catalyst DSL - Advanced Features and Options</a></li><li><a class="tocitem" href="../../../model_creation/programmatic_CRN_construction/">Programmatic Construction of Symbolic Reaction Systems</a></li><li><a class="tocitem" href="../../../model_creation/compositional_modeling/">Compositional Modeling of Reaction Systems</a></li><li><a class="tocitem" href="../../../model_creation/constraint_equations/">Constraint Equations and Events</a></li><li><a class="tocitem" href="../../../model_creation/conservation_laws/">Working with conservation laws</a></li><li><a class="tocitem" href="../../../model_creation/parametric_stoichiometry/">Symbolic Stochiometries</a></li><li><a class="tocitem" href="../../../model_creation/model_file_loading_and_export/">Loading Chemical Reaction Network Models from Files</a></li><li><a class="tocitem" href="../../../model_creation/model_visualisation/">Model Visualisation</a></li><li><a class="tocitem" href="../../../model_creation/reactionsystem_content_accessing/">Accessing model properties</a></li><li><a class="tocitem" href="../../../model_creation/network_analysis/">Network Analysis in Catalyst</a></li><li><a class="tocitem" href="../../../model_creation/chemistry_related_functionality/">Chemistry-related functionality</a></li><li><input class="collapse-toggle" id="menuitem-3-13" type="checkbox"/><label class="tocitem" for="menuitem-3-13"><span class="docs-label">Model creation examples</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../model_creation/examples/basic_CRN_library/">Library of Basic Chemical Reaction Network Models</a></li><li><a class="tocitem" href="../../../model_creation/examples/programmatic_generative_linear_pathway/">Programmatic, generative, modelling of a linear pathway</a></li><li><a class="tocitem" href="../../../model_creation/examples/hodgkin_huxley_equation/">Hodgkin-Huxley Equation</a></li><li><a class="tocitem" href="../../../model_creation/examples/smoluchowski_coagulation_equation/">Smoluchowski Coagulation Equation</a></li></ul></li></ul></li><li><span class="tocitem">Model simulation</span><ul><li><a class="tocitem" href="../../simulation_introduction/">Model Simulation Introduction</a></li><li><a class="tocitem" href="../../simulation_plotting/">Simulation plotting</a></li><li><a class="tocitem" href="../../simulation_structure_interfacing/">Interfacing problems, integrators, and solutions</a></li><li><a class="tocitem" href="../../ensemble_simulations/">Ensemble/Monte Carlo Simulations</a></li><li><a class="tocitem" href="../../ode_simulation_performance/">Advice for performant ODE simulations</a></li><li><a class="tocitem" href="../../sde_simulation_performance/">Advice for performant SDE simulations</a></li><li><input class="collapse-toggle" id="menuitem-4-7" type="checkbox" checked/><label class="tocitem" for="menuitem-4-7"><span class="docs-label">Model simulation examples</span><i class="docs-chevron"></i></label><ul class="collapsed"><li class="is-active"><a class="tocitem" href>Modelling a periodic event during ODE and jump simulations</a><ul class="internal"><li><a class="tocitem" href="#periodic_event_simulation_example_ode"><span>Modelling a circadian periodic event in an ODE simulation</span></a></li><li><a class="tocitem" href="#periodic_event_simulation_example_ode-2"><span>Modelling a circadian periodic event in a jump simulation</span></a></li><li><a class="tocitem" href="#periodic_event_simulation_plotting_light"><span>Plotting the light level</span></a></li></ul></li></ul></li></ul></li><li><span class="tocitem">Steady state analysis</span><ul><li><a class="tocitem" href="../../../steady_state_functionality/homotopy_continuation/">Finding Steady States through Homotopy Continuation</a></li><li><a class="tocitem" href="../../../steady_state_functionality/nonlinear_solve/">Finding Steady States using NonlinearSolve.jl and SteadyStateDiffEq.jl</a></li><li><a class="tocitem" href="../../../steady_state_functionality/steady_state_stability_computation/">Steady state stability computation</a></li><li><a class="tocitem" href="../../../steady_state_functionality/bifurcation_diagrams/">Bifurcation Diagrams</a></li><li><a class="tocitem" href="../../../steady_state_functionality/dynamical_systems/">Analysing model steady state properties with DynamicalSystems.jl</a></li></ul></li><li><span class="tocitem">Inverse Problems</span><ul><li><a class="tocitem" href="../../../inverse_problems/optimization_ode_param_fitting/">Parameter Fitting for ODEs using Optimization.jl and DiffEqParamEstim.jl</a></li><li><a class="tocitem" href="../../../inverse_problems/behaviour_optimisation/">Optimization for non-data fitting purposes</a></li><li><a class="tocitem" href="../../../inverse_problems/structural_identifiability/">Structural Identifiability Analysis</a></li><li><a class="tocitem" href="../../../inverse_problems/global_sensitivity_analysis/">Global Sensitivity Analysis</a></li><li><input class="collapse-toggle" id="menuitem-6-5" type="checkbox"/><label class="tocitem" for="menuitem-6-5"><span class="docs-label">Inverse problem examples</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../inverse_problems/examples/ode_fitting_oscillation/">Fitting Parameters for an Oscillatory System</a></li></ul></li></ul></li><li><span class="tocitem">Spatial Modelling</span><ul><li><a class="tocitem" href="../../../spatial_modelling/lattice_reaction_systems/">Introduction to Spatial Modelling with Catalyst</a></li><li><a class="tocitem" href="../../../spatial_modelling/lattice_simulation_structure_ interaction/">Interfacing with Lattice Problems, Integrators, and Solutions</a></li><li><a class="tocitem" href="../../../spatial_modelling/lattice_simulation_plotting/">Plotting Spatial Simulations</a></li><li><a class="tocitem" href="../../../spatial_modelling/spatial_ode_simulations/">Spatial ODE simulations</a></li><li><a class="tocitem" href="../../../spatial_modelling/spatial_jump_simulations/">Spatial jump simulations</a></li></ul></li><li><a class="tocitem" href="../../../faqs/">FAQs</a></li><li><a class="tocitem" href="../../../api/">API</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Model simulation</a></li><li><a class="is-disabled">Model simulation examples</a></li><li class="is-active"><a href>Modelling a periodic event during ODE and jump simulations</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Modelling a periodic event during ODE and jump simulations</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/SciML/Catalyst.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/SciML/Catalyst.jl/blob/master/docs/src/model_simulation/examples/periodic_events_simulation.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="periodic_event_simulation_example"><a class="docs-heading-anchor" href="#periodic_event_simulation_example">Modelling a periodic event during ODE and jump simulations</a><a id="periodic_event_simulation_example-1"></a><a class="docs-heading-anchor-permalink" href="#periodic_event_simulation_example" title="Permalink"></a></h1><p>This tutorial will describe how to simulate systems with periodic events in ODE (straightforward) and jump (slightly less, but still fairly, straightforward) simulations (SDEs use identical syntax to ODEs). We will consider a model with a <a href="https://en.wikipedia.org/wiki/Circadian_rhythm">circadian rhythm</a>, where a parameter represents the level of light. While outdoor light varies smoothly, in experimental settings a lamp is often simply turned on/off every 12 hours. Here we will model this toggling of the light using a periodic event that is triggered every 12 hours.</p><h2 id="periodic_event_simulation_example_ode"><a class="docs-heading-anchor" href="#periodic_event_simulation_example_ode">Modelling a circadian periodic event in an ODE simulation</a><a id="periodic_event_simulation_example_ode-1"></a><a class="docs-heading-anchor-permalink" href="#periodic_event_simulation_example_ode" title="Permalink"></a></h2><p>We will consider a simple circadian model, consisting of a single protein (<span>$X$</span>), which is phosphorylated (<span>$X \to Xᴾ$</span>) in the presence of light (<span>$l$</span>). Here, the light parameter can either be <span>$0$</span> (night) or <span>$1$</span> (day). We can model this using a simple periodic event which switches the value of <span>$l$</span> every 12 hours (here, <code>%</code> is the <a href="https://docs.julialang.org/en/v1/manual/mathematical-operations/#Arithmetic-Operators">remainder operator</a>).</p><pre><code class="language-julia hljs">using Catalyst
circadian_model = @reaction_network begin
    @discrete_events begin
        12 =&gt; [l ~ (l + 1)%2]
    end
 (kₚ*l,kᵢ), X &lt;--&gt; Xᴾ
end</code></pre><p class="math-container">\[ \begin{align*}
\mathrm{X} &amp;\xrightleftharpoons[k_i]{k_p l} \mathrm{X^P}  
 \end{align*}
 \]</p><p>We can now simulate this model, observing how a 24-hour cycle is reached</p><pre><code class="language-julia hljs">using OrdinaryDiffEq, Plots
u0 = [:X =&gt; 150.0, :Xᴾ =&gt; 50.0]
ps = [:kₚ =&gt; 0.1, :kᵢ =&gt; 0.1, :l =&gt; 1.0]
oprob = ODEProblem(circadian_model, u0, (0.0, 100.0), ps)
sol = solve(oprob)
plot(sol)</code></pre><img src="96c0bdc0.svg" alt="Example block output"/><h2 id="periodic_event_simulation_example_ode-2"><a class="docs-heading-anchor" href="#periodic_event_simulation_example_ode-2">Modelling a circadian periodic event in a jump simulation</a><a class="docs-heading-anchor-permalink" href="#periodic_event_simulation_example_ode-2" title="Permalink"></a></h2><p>While defining periodic events is easy for ODE and SDE simulations, due to how events are internally implemented, these cannot currently be used for jump simulations. Instead, there is a workaround which includes first creating a <a href="../../../model_creation/constraint_equations/#constraint_equations_events">conditional discrete event</a> which is designed to trigger every 13 time units:</p><pre><code class="language-julia hljs">circadian_model = @reaction_network begin
    @discrete_events begin
        (t % 12 == 0) =&gt; [l ~ (l + 1)%2]
    end
    (kₚ*l,kᵢ), X &lt;--&gt; Xᴾ
end

using JumpProcesses
u0 = [:X =&gt; 150, :Xᴾ =&gt; 50]
ps = [:kₚ =&gt; 0.1, :kᵢ =&gt; 0.1, :l =&gt; 1.0]
tspan = (0.0, 100.0)
jinput = JumpInputs(circadian_model, u0, tspan, ps)
jprob = JumpProblem(jinput)</code></pre><p>Next, if we simulate our model, we note that the events do not seem to be triggered</p><pre><code class="language-julia hljs">sol = solve(jprob)
plot(sol)</code></pre><img src="51da22ae.png" alt="Example block output"/><p>The reason is that discrete callbacks&#39; conditions are only checked at the end of each simulation time step, and the probability that these will coincide with the callback&#39;s trigger times (<span>$t = 12, 24, 36, ...$</span>) is infinitely small. Hence, we must directly instruct our simulation to stop at these time points. We can do this using the <code>tstops</code> argument:</p><pre><code class="language-julia hljs">tstops = 12.0:12.0:tspan[2]
sol = solve(jprob; tstops)
plot(sol)</code></pre><img src="c6bb1306.png" alt="Example block output"/><h2 id="periodic_event_simulation_plotting_light"><a class="docs-heading-anchor" href="#periodic_event_simulation_plotting_light">Plotting the light level</a><a id="periodic_event_simulation_plotting_light-1"></a><a class="docs-heading-anchor-permalink" href="#periodic_event_simulation_plotting_light" title="Permalink"></a></h2><p>Sometimes when simulating models with periodic parameters, one would like to plot the parameter&#39;s value across the simulation. For this, there are two potential strategies. One includes creating a <a href="https://docs.sciml.ai/DiffEqCallbacks/stable/output_saving/#DiffEqCallbacks.SavingCallback"><em>saving callback</em></a>. The other one, which we will demonstrate here, includes turning the parameter <span>$l$</span> to a <em>variable</em> (so that its value is recorded throughout the simulation):</p><pre><code class="language-julia hljs">circadian_model = @reaction_network begin
    @variables l(t)
    @discrete_events begin
        12 =&gt; [l ~ (l + 1)%2]
    end
 (kₚ*l,kᵢ), X &lt;--&gt; Xᴾ
end</code></pre><p>Next, we simulate our model like before (but providing <span>$l$</span>&#39;s value as an initial condition):</p><pre><code class="language-julia hljs">u0 = [:X =&gt; 150.0, :Xᴾ =&gt; 50.0, :l =&gt; 1.0]
ps = [:kₚ =&gt; 0.1, :kᵢ =&gt; 0.1]
oprob = ODEProblem(circadian_model, u0, (0.0, 100.0), ps)
sol = solve(oprob)</code></pre><p>If we directly plot <span>$l$</span>&#39;s value, it will be too small (compared to <span>$X$</span> and <span>$Xᴾ$</span> to be discernible). We instead <a href="../../../model_creation/dsl_advanced/#dsl_advanced_options_symbolics_and_DSL_unpack"><code>@unpack</code> our variables</a>, and then plot a re-scaled version:</p><pre><code class="language-julia hljs">@unpack X, Xᴾ, l = circadian_model
plot(sol; idxs = [X, Xᴾ, 150*l], labels = [&quot;X&quot; &quot;Xᴾ&quot; &quot;Light amplitude&quot;])</code></pre><img src="a759c8c1.svg" alt="Example block output"/></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../../sde_simulation_performance/">« Advice for performant SDE simulations</a><a class="docs-footer-nextpage" href="../../../steady_state_functionality/homotopy_continuation/">Finding Steady States through Homotopy Continuation »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.5.0 on <span class="colophon-date" title="Monday 12 August 2024 02:43">Monday 12 August 2024</span>. Using Julia version 1.10.4.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
